---
import MiniCard from "./MiniCard.astro";

const getRandomCharacters = async () => {
  const res = await fetch("https://rickandmortyapi.com/api/character");
  const data = await res.json();
  const totalCharacters = Math.min(data.info.count, 100);

  const randomIds = new Set<number>();
  while (randomIds.size < 5) {
    const randomId = Math.floor(Math.random() * totalCharacters) + 1;
    randomIds.add(randomId);
    console.log(randomIds);
  }

  const idsString = Array.from(randomIds).join(",");
  console.log(idsString);
  const response = await fetch(
    `https://rickandmortyapi.com/api/character/${idsString}`
  );
  const charactersData = await response.json();

  return Array.isArray(charactersData) ? charactersData : [charactersData];
};

const characters = await getRandomCharacters();
---

<section class="text-white flex flex-col flex-wrap mt-10 mb-20 w-full">
  <h2 class="text-center mb-10">Recommend Characters</h2>

  <div class="flex flex-row flex-wrap justify-center gap-5">
    {
      characters.map((res: any) => (
        <p>
          <MiniCard name={res.name} image={res.image} id={res.id} />
        </p>
      ))
    }
  </div>
</section>
